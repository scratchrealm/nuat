(function(){"use strict";let d,n,u,m;onmessage=function(t){t.data.canvas&&(d=t.data.canvas,p()),t.data.opts&&(n=t.data.opts,p()),t.data.eventData&&(u=t.data.eventData.spikeTimes,m=t.data.eventData.spikeAmplitudes,p())};function b(t,o){let a=!1;return()=>{a||(a=!0,setTimeout(()=>{a=!1,t()},o))}}async function T(){if(!d||!n||!u||!m)return;const{margins:t,canvasWidth:o,canvasHeight:a,visibleStartTimeSec:s,visibleEndTimeSec:l,amplitudeScaleFactor:c}=n;d.width=o,d.height=a;const e=d.getContext("2d");if(!e)return;e.clearRect(0,0,o,a);const r=i=>t.left+(o-t.left-t.right)*(i-s)/(l-s),f=i=>n?a-t.bottom-(a-t.top-t.bottom)*(i*c-n.ampMin)/(n.ampMax-n.ampMin):0,h=k(n.ampMin,n.ampMax);for(const i of h)e.strokeStyle="black",e.textAlign="right",e.textBaseline="middle",e.fillText(`${i}`,r(s)-5,f(i)),e.strokeStyle="gray",e.beginPath(),e.moveTo(r(s),f(i)),e.lineTo(r(l),f(i)),e.stroke();e.fillStyle="black";for(let i=0;i<u.length;i++){const g=u[i];if(g<s||g>l)continue;const M=m[i],v=r(g),x=f(M);e.beginPath(),e.ellipse(v,x,3,3,0,0,Math.PI*2,!1),e.fill()}}const k=(t,o)=>{const a=Math.abs(o-t),s=Math.pow(10,Math.floor(Math.log10(a))),l=a/s;let c=0;l<2?c=.2:l<5?c=.5:c=1;const e=c*s,r=Math.floor(t/e),f=Math.ceil(o/e),h=[];for(let i=r;i<=f;i++)h.push(i*e);return h},p=b(T,100)})();
